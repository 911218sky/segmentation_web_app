version: "3.8"

services:
  vessel:
    build:
      context: .
      args:
        USER_ID: ${UID:-1000}
        GROUP_ID: ${GID:-1000}
    user: "${UID:-1000}:${GID:-1000}" 
    image: sky1218/vessel-measure:latest
    container_name: vessel_measure
    ports:
      - "3015:8501"
    volumes:
      - ./user_configs:/app/user_configs
      # 如果你在 host 上開發並希望容器內可以讀程式碼
      - ./app:/app/app:ro
      - ./scripts:/app/scripts:ro
      - ./secrets:/app/secrets:ro
      - ./.streamlit:/app/.streamlit:ro
      - ./models:/app/models:ro
    restart: unless-stopped

    # 如果使用 GPU，請確保主機安裝 NVIDIA Container Toolkit
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: ["gpu"]